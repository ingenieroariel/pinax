{% extends "site_base.html" %}

{% load i18n %}
{% load gravatar %}
{% load humanize %}
{% load pagination_tags %}
{% load captureas_tag %}
{% load tagging_tags %}
{% load wiki %}
{% load markup %}
{% load switchcase %}
{% load restructuredtext %}
{% load threadedcommentstags %}
{% load shorttimesince_tag %}


{% block head_title %}{% blocktrans %}Tags{% endblocktrans %}{% endblock %}

{% block body %}
    <p><span class="warning">Note</span>: this is an <b>experimental</b> feature that is subject to massive change at any time.</p>
    
    <h1>{% trans "All Photos Matching " %}<i>"{{ tag }}"</i></h1>
    
    {% if phototags %}
        <div class="thumb-row clearfix">
        {% for photo in phototags %}
                <div class="gallery-photo-thumb">
                    <a href="/photos/details/{{ photo.id }}/"><img src="/site_media/{{ photo.get_thumbnail_url }}" alt="{{ photo.title }}"/></a><br />
                    from <a href="{% url profiles.views.profile photo.member.username %}">{{ photo.member.username }}</a><br />
                    <img src="/site_media/comment.png" border="0" class="noborder" align="absmiddle" /><a href="/photos/details/{{ photo.id }}/">{% get_comment_count for photo as commentcount %} {{ commentcount }} Comments</a>
                    <br />
                    Viewed {{ photo.view_count }} Times
                </div>
        {% endfor %}
        </div>
    {% else %}
        No photos matching tag.
    {% endif %}

    <h1>{% trans "All Blog Posts Matching " %}<i>"{{ tag }}"</i></h1>
    
    {% if alltags %}
        <p>{% trans "These are blog posts from everyone:" %}</p>
            {% for blogs in alltags %}
                <div class="blog-post clearfix">
                    <h2><a href="{{ blogs.get_absolute_url }}">{{ blogs.title }}</a></h2>
                    <div class="blog-post-tease">
                        {% with blogs.tease as body %}
                            {% switch blogs.markup %}
                                {% case 'rst' %} {{ body|restructuredtext|wikiwords|safe }} {% endcase %}
                                {% case 'mrk' %} {{ body|force_escape|markdown|wikiwords }} {% endcase %}
                                {% case 'txl' %} {{ body|force_escape|textile|wikiwords }} {% endcase %}
                                {% case '' %} {{ body|force_escape|wikiwords|linebreaks|safe }} {% endcase %}
                            {% endswitch %}
                        {% endwith %}
                    </div>
                    <div class="blog-post-meta">
                        {% gravatar blogs.author 40 %}
                        <p><b>Posted:</b><br /><a href="{% url profiles.views.profile blogs.author.username %}">{{ blogs.author.username }}</a> on {{ blogs.publish|date }}</p>
                        <div class="blog-tags">
                            <p><b>Tags:</b><br /> 
                            {% tags_for_object blogs as tags %}
                            {% for tag in tags %}
                                <a href="/tags/{{ tag }}">{{ tag }}</a>
                            {% endfor %}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
    
    {% else %}
        No blog posts matching tag.
    {% endif %}
    
    <h1>{% blocktrans %}All Projects Matching <i>{{ tag }}</i>{% endblocktrans %}</h1>
    
    <dl>
        {% for project in project_tags %}
            <dt>{{ project.name }} (<a href="{% url projects.views.project project.slug %}">{{ project.slug }}</a>)</dt>
            <dd>
                {{ project.description }}
                <div class="project_stats">
                    Members: <b>{{ project.members.count }}</b>
                    Tasks: <b>{{ project.tasks.count }}</b>
                    Topics: <b>{{ project.topics.count }}</b>
                    Wiki Pages: <b>{{ project.wiki_articles.count }}</b>
                    <br /><img src="/site_media/tags.png" border="0" class="noborder" align="absmiddle" />
                    {% tags_for_object project as tags %}
                    {% for tag in tags %}
                        <a href="/tags/{{ tag }}">{{ tag }}</a>
                    {% endfor %}
                </div>
            </dd>
        {% endfor %}
    </dl>
    
    <h1>{% blocktrans %}All Project Topics Matching <i>{{ tag }}</i>{% endblocktrans %}</h1>
    
    <table class="topics">
        {% for topic in project_topic_tags %}
            <tr class="{% cycle odd,even %}">
                <td class="meta">
                    <div class="avatar">{% gravatar topic.creator 40 %}</div>
                    <div class="details"><a href="{% url profiles.views.profile topic.creator.username %}">{{ topic.creator }}</a></div>
                    <div class="created">{{ topic.created|date }}</p>
                </td>
                <td>
                    <h2><a href="{% url project_topic topic.id %}">{{ topic.title }}</a></h2>
                    <div class="body">{{ topic.body|urlize|linebreaks }}</div>
                    {% get_comment_count for topic as comment_count %}
                    {% if comment_count %}
                        <div class="comment_stats">
                            {{ comment_count }} comment{{ comment_count|pluralize }}
                            (most recent: {{ topic.modified|date }})
                        </div>
                    {% endif %}
                    <p>
                        <img src="/site_media/tags.png" border="0" class="noborder" align="absmiddle" />
                        {% tags_for_object topic as tags %}
                        {% for tag in tags %}
                            <a href="/tags/{{ tag }}">{{ tag }}</a>
                        {% endfor %}
                    </p>
                </td>
            </tr>
        {% endfor %}
    </table>
    
    <h1>{% blocktrans %}All Project Tasks Matching <i>{{ tag }}</i>{% endblocktrans %}</h1>
    
    {% for task in project_task_tags %}
        
        <div class="task clearfix">
            <div class="task-meta">
                {% if task.assignee %}
                    <div class="avatar">{% gravatar task.assignee 40 %}</div>
                    <div class="details"><b>Assignee</b>: <a href="{% url profiles.views.profile task.assignee.username %}">{{ task.assignee }}</a></div>
                {% else %}
                    <span class="warning">Unassigned</span>
                {% endif %}
                <div><b>State</b>: {{ task.get_state_display }}</div>
                <div><b>Creator</b>: <a href="{% url profiles.views.profile task.creator.username %}">{{ task.creator }}</a></div>
                <div><b>Created</b>: {{ task.created|date }}</div>
                <div><b>Modified</b>: {{ task.modified|shorttimesince }} ago</div>
            </div>
            <div class="bulk">
                <h2><a href="{% url project_task task.id %}">{{ task.summary }}</a></h2>
                <div class="body">{{ task.detail|urlize|linebreaks }}</div>
                <div class="task-meta2">
                    {% get_comment_count for task as comment_count %}
                    {% if comment_count %}
                        {{ comment_count }} comment{{ comment_count|pluralize }};
                    {% endif %}
                    <b>Status</b>: 
                    {% if task.status %}
                        {{ task.status }}
                    {% else %}
                        none
                    {% endif %}
                </div>
                <p>
                    <img src="/site_media/tags.png" border="0" class="noborder" align="absmiddle" />
                    {% tags_for_object task as tags %}
                    {% for tag in tags %}
                        <a href="/tags/{{ tag }}">{{ tag }}</a>
                    {% endfor %}
                </p>
            </div>
        </div>
        
    {% endfor %}
    
    
{% endblock %}