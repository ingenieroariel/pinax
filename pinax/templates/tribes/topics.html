{% extends "tribes/base.html" %}

{% load i18n %}
{% load gravatar %}
{% load threadedcommentstags %}
{% load pagination_tags %}
{% load tagging_tags %}

{% block head_title %}{% blocktrans with tribe.name as tribe_name %}Topics for {{ tribe_name }}{% endblocktrans %}{% endblock %}

{% block body %}
    <h1>{% trans "Discussion Topics for Tribe" %} <a href="{% url tribe_detail tribe.slug %}">{{ tribe.name }}</a></h1>
    
    {% autopaginate tribe.topics.all %}
    
    <table class="topics">
        {% for topic in tribe.topics.all %}
            <tr class="{% cycle odd,even %}">
                <td class="meta">
                    <div class="avatar">{% gravatar topic.creator 40 %}</div>
                    <div class="details"><a href="{% url profiles.views.profile topic.creator.username %}">{{ topic.creator }}</a></div>
                    <div class="created">{{ topic.created|date }}</p>
                </td>
                <td>
                    <h2><a href="{% url tribe_topic topic.id %}">{{ topic.title }}</a></h2>
                    <div class="body">{{ topic.body|urlize|linebreaks }}</div>
                    {% get_comment_count for topic as comment_count %}
                    {% if comment_count %}
                        <div class="comment_stats">
                            {% blocktrans count comment_count as comment_count %}
                                One comment
                            {% plural %}
                                {{ comment_count }} comments
                            {% endblocktrans %}
                            {% blocktrans with topic.modified|date as topic_modified_date %}
                                (most recent: {{ topic_modified_date }})
                            {% endblocktrans %}
                        </div>
                    {% endif %}
                    <p>
                        <img src="/site_media/tags.png" border="0" class="noborder" align="absmiddle" />
                        {% tags_for_object topic as tags %}
                        {% for tag in tags %}
                            <a href="/tags/{{ tag }}">{{ tag }}</a>
                        {% endfor %}
                    </p>
                </td>
            </tr>
        {% endfor %}
    </table>
    
    {% paginate %}
    
    
    <h2>{% trans "New Topic" %}</h2>
    
    <form action="{% url tribe_topics tribe.slug %}" method="POST">
        <table>
            {{ topic_form }}
            <tr><td><input type="submit" value="{% trans "Create New Topic" %}" /></td></tr>
        </table>
        <input type="hidden" name="next" value="{{ request.path }}" />
    </form>
    
{% endblock %}
