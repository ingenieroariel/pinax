{% extends "site_base.html" %}

{% block head_title %}Pinax : Profile for {{ other_user }}{% endblock %}

{% block rtab_id %}profile_tab{% endblock %}

{% block body %}

{% load gravatar %}
{% gravatar other_user 80 %}

<h1>Profile for {{ other_user }}</h1>

<div class="profile_info">
    {% if other_user.get_profile.name %}<p><b>Name</b>: {{ other_user.get_profile.name }}</p>{% endif %}
    {% if other_user.get_profile.about %}<p><b>About</b>: {{ other_user.get_profile.about }}</p>{% endif %}
    {% if other_user.get_profile.location%}<p><b>Location</b>: {{ other_user.get_profile.location }}</p>{% endif %}
    {% if other_user.get_profile.website %}<p><b>Website</b>: <a href="{{ other_user.get_profile.website }}">{{ other_user.get_profile.website }}</a></p>{% endif %}
</div>

{% if user.is_authenticated %}
{% if is_me %}

<p><a href="#" onclick="$('#profile_form').toggle(); return false;">Edit profile</a></p>

<form id="profile_form" method="POST" action="" style="display: none;">
<table>
{{ profile_form }}
<tr><td></td><td><input type="submit" name="action" value="update" /></td></tr>
</table>
</form>

<h2>Your Friends</h2>
{% if other_friends %}
<table class="friend_list">
{% for friendship in other_friends %}
    <tr>
        <td>{% gravatar friendship.friend 40 %}</td>
        <td><a href="{% url profiles.views.profile friendship.friend.username %}">{{ friendship.friend }}</a></td>
    </tr>
{% endfor %}
</table>
{% else %}
<p>None. You should look at the list of <a href="/profiles/">profiles</a> and see if there's anyone you know.</p>
{% endif %}
{% else %}
{% if is_friend %}
<p>You are friends with {{ other_user }}. <a href="{% url messages.views.compose %}{{ other_user }}/">Send a message</a>.</p>
<h2>{{ other_user }}'s Friends</h2>
<table class="friend_list">
{% for friendship in other_friends %}
    <tr>
        <td>{% gravatar friendship.friend 40 %}</td>
        <td><a href="{% url profiles.views.profile friendship.friend.username %}">{{ friendship.friend }}</a></td>
    </tr>
{% endfor %}
</table>

{% else %}
<h2>Add As Friend</h2>
{% if previous_invitations_from %}
<p>{{ other_user }} has already requested friendship.</p>
{% for invitation in previous_invitations_from %}
<div class="friendship_request">
    <p>{{ invitation.message }}</p>
    <form style="display: none;" id="invitation_{{ invitation.id }}" method="post" action="">
        <input type="hidden" name="invitation" value="{{ invitation.id }}"/>
        <input type="hidden" name="action" value="accept"/>
    </form>
    <p><a href="#" onclick="$('#invitation_{{ invitation.id }}').submit()">accept</a></p>
</div>
{% endfor %}
{% else %}
{% if previous_invitations_to %}
<p>Friendship request sent.</p>
{% else %}
<form method="POST" action="">
    <table>
    {{ invite_form.as_table }}
    <tr><td></td><td><input type="submit" name="action" value="invite" /> {{ other_user }} to be a friend.</td></tr>
    </table>
</form>
{% endif %}
{% endif %}
{% endif %}
{% endif %}
{% else %}
<p><a href="/account/signup/">Sign up</a> and <a href="/account/login/">log in </a> to add this person as a friend.</p>
{% endif %}

{% endblock %}
