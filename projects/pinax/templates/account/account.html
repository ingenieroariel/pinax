{% extends "site_base.html" %}

{% block head_title %}Tabula Rasa : Account{% endblock %}

{% block body %}
<h1>Account</h1>
{% if user.is_authenticated %}

<h2>Email Addresses</h2>
{% if user.emailaddress_set.all %}
<table class="email_list">
{% for emailaddress in user.emailaddress_set.all %}
    <tr>
        <td>{% if emailaddress.primary %}<b>{{ emailaddress.email }}</b>{% else %}{{ emailaddress.email }}{% endif %}</td>
        {% if emailaddress.verified %}
        <td><span class="verified">verified</span>
        {% if emailaddress.primary %}
        - <span class="primary">primary</span>
        {% else %}
        <form style="display: none;" id="primary_{{ forloop.counter }}" method="post" action="">
            <input type="hidden" name="email" value="{{ emailaddress.email }}"/>
            <input type="hidden" name="action" value="primary"/>
        </form>
        -
        <a href="#" onclick="$('#primary_{{ forloop.counter }}').submit();">make primary</a>
        {% endif %}
        </td>
        {% else %}
        <td><span class="unverified">unverified</span>
        <form style="display: none;" id="send_{{ forloop.counter }}" method="post" action="">
            <input type="hidden" name="email" value="{{ emailaddress.email }}"/>
            <input type="hidden" name="action" value="send"/>
        </form>
        -
        <a href="#" onclick="$('#send_{{ forloop.counter }}').submit();">re-send verification email</a></td>
        {% endif %}
        <td>
        {% if emailaddress.primary %}
        {% else %}
        <form style="display: none;" id="remove_{{ forloop.counter }}" method="post" action="">
            <input type="hidden" name="email" value="{{ emailaddress.email }}"/>
            <input type="hidden" name="action" value="remove"/>
        </form>
        <a class="remove" href="#" onclick="$('#remove_{{ forloop.counter }}').submit()">remove</a>
        {% endif %}
        </td>
    </tr>
{% endfor %}
</table>
{% else %}
<p><span class="warning">None</span>. You should really add one so you can receive notifications, reset your password if you forget it, etc.</p>
{% endif %}

<h3>Add Email Address</h3>
<form method="post" action="">
<table>{{ add_email_form.as_table }}
<tr><td></td><td><input type="submit" name="action" value="add"/></td></tr>
</table>
</form>

<h2>Change Password</h2>

<form method="post" action="">
<table>{{ password_change_form.as_table }}
<tr><td></td><td><input type="submit" name="action" value="change password"/></td></tr>
</table>
</form>

{% else %}
<p><span class="warning">Note</span>: Not logged in.</p>
{% endif %}
{% endblock %}

{% block extra_body %}
{% endblock %}